# 3Dモード切り替えフロー改善の実装確認

## 変更概要
- **統一された権限要求UI**: `SensorPermissionRequest` を刷新し、Glassmorphismとアニメーションを採用しました。
- **事前チェック (Pre-flight Check)**: 2Dマップ (`OkutamaMap2D`) から3Dへ遷移する前にセンサー権限を確認し、未許可の場合のみモーダルを表示するようにしました。
- **権限キャッシュ**: `OrientationService` に権限状態をキャッシュするロジックを追加し、iOSでの画面遷移時（コンポーネント再マウント時）にユーザー操作なしでスムーズにセンサーを再開できるようにしました。
- **3Dビューの初期化改善**: `Scene3D` での独自モーダルを廃止し、万が一権限が不足している場合は統一UIを表示するように変更しました。

## 検証手順

### 1. 2Dマップからの遷移（正常系）
1. 2Dマップ画面を開く。
2. 「3Dモード」ボタンをクリック。
3. **期待される動作**:
    - 初回の場合は `SensorPermissionRequest` モーダルが表示される。
    - デザインが刷新されていることを確認（背景ぼかし、アイコン）。
    - 各項目の「許可」を押し、最後に「アプリを開始」で3D画面へ遷移。
    - 2回目以降（または既に許可済み）の場合は、モーダルが表示されず**即座に**3D画面へ遷移する。

### 2. 3Dビューでの動作（モバイル）
1. 3D画面に遷移後、デバイスを動かす。
2. **期待される動作**:
    - ジャイロ（Orientation）が効いており、デバイスの向きに合わせて視点が移動する。
    - コンポーネントのアンマウント/マウントを経ても（戻るボタン等）、再遷移時にエラーにならない（キャッシュの有効性確認）。

### 3. 直接アクセス（異常系/コーナーケース）
1. 3DビューのURLを直接開く、またはリロードする。
2. **期待される動作**:
    - iOSの場合、自動開始できないため `SensorPermissionRequest` が表示される。
    - 「許可」操作を行うことで正常にセンサーが開始される。

## 確認済みファイル
- `src/services/sensors/OrientationService.ts`
- `src/components/ui/SensorPermissionRequest.tsx`
- `src/components/map/OkutamaMap2D.tsx`
- `src/components/viewer/Scene3D.tsx`
